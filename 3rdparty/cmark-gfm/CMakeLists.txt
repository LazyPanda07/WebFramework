cmake_minimum_required(VERSION 3.27.0)

set(LICENSE_INSTALLING_AVAILABLE OFF)

project(external_cmark_gfm)

if (EXISTS ${PROJECT_SOURCE_DIR}/../../cmake/BuildLibrary.cmake)
	include(${CMAKE_SOURCE_DIR}/cmake/BuildLibrary.cmake)
	set(LICENSE_INSTALLING_AVAILABLE ON)
else()
	include(${WEB_FRAMEWORK_CMAKE_DIRECTORY}/BuildLibrary.cmake)
endif()

set(CMARK_GFM_TAG 0.29.0.gfm.13)
set(CMARK_BUILD_ARGUMENTS "")
set(CMARK_BUILD_CMARK_INSTALL_PREFIX ${CMAKE_BINARY_DIR}/_deps/build_cmark)

list(APPEND CMARK_BUILD_ARGUMENTS "-DCMAKE_POLICY_VERSION_MINIMUM=3.5" "-DCMARK_SHARED=OFF" "-DCMARK_TESTS=OFF")

if (${CMAKE_SYSTEM_NAME} STREQUAL "Android")
	set(ANDROID_CMAKE_BUILD_ARGUMENTS $ENV{ANDROID_CMAKE_BUILD_ARGUMENTS})

	separate_arguments(ANDROID_CMAKE_BUILD_ARGUMENTS)

	list(APPEND CMARK_BUILD_ARGUMENTS "-DCMAKE_POLICY_VERSION_MINIMUM=3.5" ${ANDROID_CMAKE_BUILD_ARGUMENTS})
endif()

build_cmake_library(
	${PROJECT_NAME}
	${CMAKE_PROJECT_NAME}
	https://github.com/github/cmark-gfm.git
	${CMARK_GFM_TAG}
	${CMARK_BUILD_CMARK_INSTALL_PREFIX}
	CMARK_BUILD_ARGUMENTS
)

if (UNIX)
	list(APPEND ADDITIONAL_LIBS cmark-gfm)
else()
	list(APPEND ADDITIONAL_LIBS cmark-gfm_static)
endif()

list(APPEND ADDITIONAL_INCLUDES ${CMARK_BUILD_CMARK_INSTALL_PREFIX}/include)
list(APPEND ADDITIONAL_LIB_DIRS ${CMARK_BUILD_CMARK_INSTALL_PREFIX}/lib)

set(ADDITIONAL_LIBS ${ADDITIONAL_LIBS} CACHE INTERNAL "")
set(ADDITIONAL_INCLUDES ${ADDITIONAL_INCLUDES} CACHE INTERNAL "")
set(ADDITIONAL_LIB_DIRS ${ADDITIONAL_LIB_DIRS} CACHE INTERNAL "")

if (${LICENSE_INSTALLING_AVAILABLE})
	install(DIRECTORY license/ DESTINATION license)
endif()
