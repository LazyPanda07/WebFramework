name: Distribution


on:
  release:
  workflow_dispatch:


jobs:
  pip-package:
    runs-on: ubuntu-latest
    container:
      image: lazypanda07/ubuntu_cxx20:24.04
    
    steps:
    - name: Get Linux latest release
      uses: robinraju/release-downloader@v1.11
      with:
        repository: ${{ github.repository }}
        latest: true
        extract: true
        fileName: linux.zip

    - name: Get Windows latest release
      uses: robinraju/release-downloader@v1.11
      with:
        repository: ${{ github.repository }}
        latest: true
        extract: true
        fileName: windows.zip

    - name: Create package folder
      run: |
          mkdir package
          mkdir package/dll
          mkdir package/lib
          cp -r ReleaseDLL_Linux/api/python_api package
          mv ReleaseDLL_Windows/dll/*.dll package/dll
          mv ReleaseDLL_Linux/lib/*.so package/lib

    - name: Build wheel
      working-directory: package
      run: python3 -m build

    - name: Upload artifacts
      uses: actions/upload-artifact@v4
      with:
        name: pip-package
        path: package/dist
