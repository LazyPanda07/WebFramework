name: Build SQLite


# on: workflow_dispatch
on: 
  push:
    branches: [dev]
  

jobs:
  windows-build:
    runs-on: windows-latest

    steps:
    - name: Get SQLite
      uses: actions/checkout@v4
      with:
        repository: sqlite/sqlite
        ref: version-3.45.2

    - name: Enable NMake
      uses: ilammy/msvc-dev-cmd@v1.13.0
        
    - name: LS
      run: ls
          
    - name: Build
      run: |
          nmake /f Makefile.msc
          nmake /f Makefile.msc sqlite3.c
          
    - name: LS
      run: ls

    
  linux-build:
    runs-on: ubuntu-latest

    steps:
    - name: Get SQLite
      uses: actions/checkout@v4
      with:
        repository: sqlite/sqlite
        ref: version-3.45.2
        
    - name: LS
      run: ls
          
    - name: Build
      run: |
          export CC=/usr/bin/gcc-13
          export CXX=/usr/bin/g++-13
          mkdir build
          cd build
          ../configure
          make -j $(nproc)
          gcc sqlite3.c -shared -O3 -fPIC -lpthread -ldl -o libsqlite3.so
          
    - name: LS
      run: cd build && ls

    - name: Upload SQLite
      uses: actions/upload-artifact@v4
      with:
        name: sqlite
        path: build/libsqlite3.so
